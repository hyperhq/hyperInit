# The init Task for HyperContainer

You can get the binary installer of HyperContainer and HyperStart through [The Hyper Page](https://github.com/hyperhq/hyperd)

## Build from source 

clone this repo, and make sure you have build-essentials installed. Go into the working copy and

    > ./autogen.sh
    > ./configure
    > make

Then you can find `hyper-initrd.img` in the build directory, together with a pre-built kernel.

### Build for VirtualBox
If you want to get the boot disk file for VirtualBox, please reconfigure with flag --with-vbox,

    > ./configure --with-vbox
    > make

Then you can find `hyper-vbox-bootimage.iso` in the build directory. Booting from this iso will
bring you to the hyper world.

### Build with musl libc
the repo maintains musl libc in build/musl.tar.gz. you can use `musl-gcc` which generated by autogen.sh
to build hyperstart with musl libc.

    > ./autogen.sh musl

this will show you the configure command line, such as
`CC=path/musl-gcc ./configure --with-musl --host=x86_64-none-linux`

execute this configure command line,

    > CC=path/musl-gcc ./configure --with-musl --host=x86_64-none-linux
    > make

Then you can find `hyper-initrd.img` in the build directory.

### Build iptables
hyper-initrd.img contains `iptables` program to setup iptables rules. this `iptables` program is compiled
by `musl-gcc` from prev section. and you should patch iptables source with
[iptables-patch](https://github.com/sabotage-linux/sabotage/blob/master/KEEP/iptables-1.4.14-musl-fixes.patch)
to make sure compile with musl libc is successful.

    > wget http://www.netfilter.org/projects/iptables/files/iptables-1.4.21.tar.bz2
    > bunzip2 and tar xvf iptables
    > cd path/iptables
    > patch iptables
    > ./autogen.sh
    > CC=path/musl-gcc ./configure --host=x86_64-none-linux --disable-devel --disable-shared --enable-static
    > make CFLAGS=--static
    > strip iptables/xtables-multi (optional)

then you can find `xtables-multi` in iptables/ sub-directroy, copy it to the hyperstart/build/iptables.
